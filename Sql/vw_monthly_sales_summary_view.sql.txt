-- 1) Monthly Revenue & Orders Trend
CREATE OR REPLACE VIEW vw_monthly_sales_summary AS
SELECT
    DATE_FORMAT(order_date, '%Y-%m-01') AS month_start,
    YEAR(order_date)                    AS order_year,
    MONTH(order_date)                   AS order_month,
    platform,
    category,
    COUNT(DISTINCT order_id)            AS total_orders,
    SUM(net_amount)                     AS total_revenue,
    AVG(net_amount)                     AS avg_order_value
FROM ecommerce_orders_raw_table
WHERE order_date IS NOT NULL
GROUP BY
    DATE_FORMAT(order_date, '%Y-%m-01'),
    YEAR(order_date),
    MONTH(order_date),
    platform,
    category;